{% extends "base.html" %}
{% load static %}

{% block content %}

    <div class="container-fluid checkout-container">
        <div class="row shopping-title">
            <div class="col-12 col-md-6">
                <h1 class="text-uppercase">shopping cart</h1>
                <hr>
            </div>
        </div>
    {% if cart_items %}
        <div class="row">
            <table id="data-row">
                <thead>
                    <tr>
                        <th class="px-2 head-info">Service Info</th>
                        <th class="px-2 head-info text-center">Service Price Per Bedroom</th>
                        {% if request.user.is_authenticated %}
                            <th class="px-2 head-info">Property</th>
                            <th class="text-center head-info data-no-of-bedrooms">Property Number Of Bedrooms</th>
                        {% else %}
                            <th class="text-center head-info data-no-of-bedrooms">Number Of Bedrooms The Service To Be Executed For</th>
                        {% endif %}
                        <th class="text-center head-info">Total Cost Per Property</th>
                        <th class="text-center head-info data-total_for_all_properties">Total Cost For All Properties</th>
                        
                    </tr>
                </thead>
                    {% for item in cart_items %}
                    <tr>
                        <td id="service-data" class="px-2 text-uppercase"><strong>{{ item.service }}</strong>
                            <form method="POST" action="{% url 'remove_from_cart' item.service.id %}" class="remove-service remove-form">
                                {% csrf_token %}
                                <input type="submit" value="Remove" id="remove-service-buttons" class="buttons">
                            </form>
                        </td>
                        <td class="px-2 text-center">£<span class="currency-margin">{{ item.service.price }}</span></td>
                        {% if request.user.is_authenticated %}
                            <td class="px-2">
                                {% for property in item.properties_or_bedrooms %}
                                    <div id="address-data" class="table-data">{{ property.property.street_address }}</div>
                                    <form method="POST" action="{% url 'remove_from_cart' item.service.id %}" class="remove_address remove-form">
                                    {% csrf_token %}
                                        <input type="hidden" name="property_id" value="{{ property.property.id }}">
                                        <input type="submit" value="Remove" class="buttons remove-buttons">
                                    </form>
                                    {% if not forloop.last %} <hr class="separator"> {% endif %}
                                {% endfor %}
                        {% endif %}
                            </td>
                        <td class="text-center">
                            {% if request.user.is_authenticated %}
                                {% for property in item.properties_or_bedrooms %}   
                                    {% if item.service.price_variation %}
                                        <div class="table-data data-no-of-bedrooms multiple-data">{{ property.property.no_of_bedrooms }}</div> {% if not forloop.last %} <hr class="separator"> {% endif %}
                                    {% else %}
                                        <div class="table-data data-no-of-bedrooms text-capitalize multiple-data">fixed price</div>  {% if not forloop.last %} <hr class="separator"> {% endif %}
                                    {% endif %}                               
                                {% endfor %}
                            {% else %}
                                {% for bedroom in item.properties_or_bedrooms %}
                                    {% if item.service.price_variation %}
                                        <div class="table-data data-no-of-bedrooms multiple-data">{{ bedroom.no_of_bedrooms }}</div>
                                        <form method="POST" action="{% url 'remove_from_cart' item.service.id %}" class="remove_address remove-form">
                                    {% csrf_token %}
                                        <input type="hidden" name="no_of_bedrooms" value="{{ bedroom.no_of_bedrooms }}">
                                        <input type="submit" value="Remove" class="buttons remove-buttons">
                                        </form> 
                                        {% if not forloop.last %} <hr class="separator"> {% endif %}
                                    {% else %}
                                        <div class="table-data data-no-of-bedrooms text-capitalize multiple-data">fixed price</div>  {% if not forloop.last %} <hr class="separator"> {% endif %}
                                    {% endif %}                               
                                {% endfor %}
                            {% endif %}
                        </td>
                        <td class="text-center">
                            {% for property_or_no_of_bedrooms in item.properties_or_bedrooms %}
                                <div class="table-data multiple-data">£<span class="currency-margin">{{ property_or_no_of_bedrooms.total_cost }}</span></div> {% if not forloop.last %} <hr class="separator"> {% endif %}
                            {% endfor %}
                        </td>
                        <td class="text-center data-total_for_all_properties">£<span class="currency-margin">{{ item.total_for_all_properties }}</span></td>
                    </tr>
                    {% endfor %}
            </table>
        </div>
        <div class="row">
            <div class="col-12 grand-total-col mx-0 px-0 text-uppercase text-center">
                <div class="grand-total">total: <span class="currency-margin">£<span id="grand-total-span">{{ grand_total }}</span></span></div>
            </div>
        </div>
    </div>
{% else %}
    <div class="row cart-empty-row">
        <div class="col-12">
            <h2 class="text-uppercase">your shopping cart is empty</h2>
        </div>
    </div>
{% endif %}

{% endblock %}

{% block postloadjs %}
<script type="text/javascript">
    $(document).ready(function () {
        $('.navbar').css('background-color', 'rgb(33,0,112)');
    });
</script>
{% endblock %}