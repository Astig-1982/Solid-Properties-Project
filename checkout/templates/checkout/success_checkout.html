{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid checkout-container">
    <div class="row checkout-title">
            <div class="col-12">
                <h1 class="text-uppercase">order succesful</h1>
                <hr>
            </div>
        </div>
</div>
<div class="container success-order-container">
    <div class="row">
        <div class="col-12 order-details-col">
            <p>Your order was succesful. We have sent a confirmation email to <strong>{{ order.email }}</strong>. Your order total is  <strong>£{{ order.grand_total }}</strong>.</p>
            <fieldset>
                <legend class="order-billing-legends">Order Info</legend>
            <table class="success-tables shadow-sm mb-5 bg-white">
            <thead>
                    <tr class="first-tr">
                        <th class="px-2"><span class="order-number-span">Order Number</span></th>
                        <th id="order-date-th" class="px-2">Order Date</th>
                    </tr>
                </thead>
                    <tr id="data-tr">
                        <td class="px-2 text-uppercase"><strong><span class="order-number-span">{{ order.order_number }}</span></strong></td>
                        <td id="order-date-td" class="px-2">{{ order.date }}</td>
                    </tr>   
            </table>
            </fieldset>

            <fieldset class="mt-2">
                <legend id="order-details-legend">Order Details</legend>
            <table class="success-tables shadow-sm mb-5 bg-white">
                <thead>
                    <tr class="first-tr">
                        <th class="px-2"><span class="success-tables-padding">Service</span></th>
                        {% if request.user.is_authenticated %}
                            <th class="px-2">Property</th>
                        {% else %}
                            <th class="px-2 text-capitalize">no of bedrooms to be executed for</th>
                        {% endif %}
                        <th id="lineitem-total-td" class="px-2">Total Cost</th>
                    </tr>
                </thead>
                {% if request.user.is_authenticated %}
                    {% for item in order.lineitems.all %}
                        <tr>
                            <td class="px-2 text-capitalize"><strong><span class="success-tables-padding">{{ item.service.name }}</span></strong></td>                        
                            <td class="px-2">{{ item.the_property.street_address }}</td>
                            <td class="px-2">£{{ item.lineitem_total }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    {% for item in order.lineitemsanonym.all %}
                        <tr>
                            <td class="px-2 text-capitalize"><strong><span class="success-tables-padding">{{ item.service.name }}</span></strong></td>
                            {% if item.service.price_variation %}                        
                                <td class="px-2">{{ item.no_of_bedrooms }}</td>
                            {% else %}
                                <td class="px-2 text-capitalize">fixed price</td>
                            {% endif %}
                            <td class="px-2">£{{ item.lineitem_total }}</td>
                        </tr>
                    {% endfor %}
                {% endif %}   
            </table>
            </fieldset>

            <fieldset class="mt-2">
                <legend class="order-billing-legends">Billing Details</legend>
            <table class="success-tables shadow-sm mb-5 bg-white">
                <thead>
                    <tr class="first-tr">
                        <th class="px-2"><span class="billing-address-details">Full Name</span></th>
                        <th class="px-2"><span class="billing-address-email">Email Address</span></th>
                        <th class="px-2 billing-address-address">Street Address</th>
                        {% if order.street_address2 %}
                            <th class="px-2 billing-address-address">Street Address 1</th>
                            <th class="px-2 billing-address-address">Street Address 2</th>
                        {% endif %}
                    </tr>
                </thead>
                    <tr>
                        <td class="px-2 text-capitalaize"><span class="billing-address-details">{{ order.full_name }}</span></td>
                        <td class="px-2"><span class="billing-address-email">{{ order.email }}</span></td>
                        <td class="px-2 street-address-details">{{ order.street_address1 }}</td>
                        {% if order.street_address2 %}
                            <tr class="px-2 street-address-details">{{ order.street_address2 }}</tr>
                        {% endif %}
                    </tr>
                    <thead>
                        <tr class="first-tr">
                            <th class="px-2"><span class="billing-address-details">Town or City</span></th>
                            <th class="px-2"><span class="billing-address-email">Postal Code</span></th>
                            <th class="px-2 billing-address-address">Phone Number</th>
                        </tr>
                        <tr>
                            <td class="px-2"><span class="billing-address-details">{{ order.town_or_city }}</span></td>
                            <td class="px-2"><span class="billing-address-email">{{ order.postcode }}</span></td>
                            <td class="px-2">{{ order.phone_number }}</td>
                        </tr>
                    </thead>
            </table>
            </fieldset>
            <div class="col-12">
                <p id="billing-total" class="text-capitalize float-right"><strong>total amount: <span id="total-amount">£{{ order.grand_total }}</span></strong></p>
            </div>
        </div>
</div>
</div>


{% endblock %}

{% block postloadjs %}

{{ stripe_public_key|json_script:"id_stripe_public_key" }}
{{ client_secret|json_script:"id_client_secret" }}
<script src="{% static 'checkout/js/stripe_elements.js' %}"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $('.navbar').css('background-color', 'rgb(33,0,112)');
    });
</script>
    
{% endblock %}